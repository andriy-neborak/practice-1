# üéÆ STM32 Match-3 Hardware Engine ‚Äî Project Specifications

## üíª System Requirements (PC Client)

### Operating System:
* [x] Windows 10 / Windows 11 (64-bit)

### Architecture:
* [x] x64 (recommended)

### Minimum Hardware Requirements:
* [x] CPU: Dual-core 1.8 GHz or higher
* [x] RAM: 4 GB
* [x] Storage: ~100 MB free space

## üõ† Development Environment
**PC Client:**
* [x] Visual Studio Code / PyCharm
* [x] Python Version: 3.11+ *(–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ 3.12)*
* [x] Graphics: `pygame-ce` (Community Edition)
* [x] Serial Comms: `pyserial` 3.5+

**Hardware Server:**
* [x] **Target Board:** STM32F0Discovery (–∞–±–æ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∞, –Ω–∞–ø—Ä. STM32F103)
* [x] **MCU:** STM32F051R8 (ARM Cortex-M0) / STM32F103C8T6
* [x] **IDE:** STM32CubeIDE
* [x] **Compiler:** GCC for ARM Embedded Processors (`arm-none-eabi`)

---

## ‚öôÔ∏è –¢–µ—Ö–Ω—ñ—á–Ω–∞ –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞
* **–®–∞–±–ª–æ–Ω:** –ö–ª—ñ—î–Ω—Ç-–°–µ—Ä–≤–µ—Ä (–ü–ö ‚Äî "–†–µ–∂–∏—Å–µ—Ä/–ú–æ–Ω—ñ—Ç–æ—Ä", STM32 ‚Äî "–§—ñ–∑–∏—á–Ω–∏–π —Ä—É—à—ñ–π").
* **–ê–ø–∞—Ä–∞—Ç–Ω–∞ –ª–æ–≥—ñ–∫–∞:** –í—Å—ñ –ø—Ä–æ—Ä–∞—Ö—É–Ω–∫–∏ –∑–±—ñ–≥—ñ–≤ (Match-3), –≥—Ä–∞–≤—ñ—Ç–∞—Ü—ñ—ó, –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –ø–æ–ª—è —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–∞ –≥–ª—É—Ö–∏–π –∫—É—Ç (Deadlock) –≤–∏–∫–æ–Ω—É—é—Ç—å—Å—è –Ω–∞ STM32.
* **–ê–Ω—ñ–º–∞—Ü—ñ—ó:** –†–µ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞ (Python) –¥–ª—è –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –ø–ª–∞–≤–Ω–∏—Ö 60 FPS –±–µ–∑ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –º—ñ–∫—Ä–æ–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞.

---

## üì° –ü—Ä–æ—Ç–æ–∫–æ–ª –æ–±–º—ñ–Ω—É (Binary UART Protocol)

–ó–≤'—è–∑–æ–∫ –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ UART (BaudRate: 38400, 8N1).
–û–±–º—ñ–Ω –¥–∞–Ω–∏–º–∏ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –±—ñ–Ω–∞—Ä–Ω–∏–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏ —Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ—ó –¥–æ–≤–∂–∏–Ω–∏ ‚Äî **6 –±–∞–π—Ç**.
–ú—ñ–∂ –ø–∞–∫–µ—Ç–∞–º–∏ –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Ä–æ–∑–¥—ñ–ª—å–Ω–∏–∫–∏, –∞–ª–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è —Ç–∞–π–º–∞—É—Ç –ø—Ä–∏–π–æ–º—É **10 –º—Å** –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ —Ä–æ–∑—Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó.

### üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç—É
| Byte 0 | Byte 1 | Byte 2 | Byte 3 | Byte 4 | Byte 5 |
| :---: | :---: | :---: | :---: | :---: | :---: |
| **CMD** | **ADDR_H** | **ADDR_L** | **DATA_H** | **DATA_L** | **CRC-8** |
| –ö–æ–º–∞–Ω–¥–∞ | –†—è–¥–æ–∫ 1 / –î–∞–Ω—ñ | –°—Ç–æ–≤–ø—á–∏–∫ 1 / –î–∞–Ω—ñ | –†—è–¥–æ–∫ 2 / –ö–æ–ª—ñ—Ä / –î–∞–Ω—ñ | –°—Ç–æ–≤–ø—á–∏–∫ 2 / –°—Ç–∞—Ç—É—Å / –î–∞–Ω—ñ | Checksum |

### üîê –í–∞–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞ CRC-8
–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ —Å—É–º–∞ —Ä–æ–∑—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –∑–∞ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∏–º –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º **CRC-8** (–Ω–µ –º–æ–¥—É–ª—å–Ω–∞ —Å—É–º–∞!).
* **–ü–æ–ª—ñ–Ω–æ–º:** `0x07`
* **Init:** `0x00`
* –Ø–∫—â–æ CRC –≤—ñ–¥ –∫–ª—ñ—î–Ω—Ç–∞ –Ω–µ –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–∏–º –Ω–∞ –ø–ª–∞—Ç—ñ, STM32 —ñ–≥–Ω–æ—Ä—É—î –∫–æ–º–∞–Ω–¥—É —ñ –ø–æ–≤–µ—Ä—Ç–∞—î –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–∏–π –ø–∞–∫–µ—Ç –ø–æ–º–∏–ª–∫–∏: `EE [Calc_CRC] [RX_CRC] EE EE [CRC]`.

---

### üìã –¢–∞–±–ª–∏—Ü—è –∫–æ–º–∞–Ω–¥ (Commands Reference)

| HEX | –ö–æ–º–∞–Ω–¥–∞ | –ù–∞–ø—Ä—è–º–æ–∫ | –û–ø–∏—Å –¥—ñ—ó —Ç–∞ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–∏—Ö |
| :---: | :--- | :---: | :--- |
| **`0x10`** | `NEW GAME` | `PC -> MCU` | –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î –Ω–æ–≤–µ –ø–æ–ª–µ –±–µ–∑ –≥–æ—Ç–æ–≤–∏—Ö –∑–±—ñ–≥—ñ–≤. –û–±–Ω—É–ª—è—î —Ä–∞—Ö—É–Ω–æ–∫.<br>**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è `[10 00 00 00 AA CRC]` + –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –¥–∞–º–ø –≤—Å—å–æ–≥–æ –ø–æ–ª—è —á–µ—Ä–µ–∑ –ø–∞–∫–µ—Ç–∏ `0x16`. |
| **`0x11`** | `SWAP` | `PC -> MCU` | –ó–∞–ø–∏—Ç –Ω–∞ —Ö—ñ–¥ –≥—Ä–∞–≤—Ü—è. –ë–∞–π—Ç–∏ 1-4 –º—ñ—Å—Ç—è—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: `r1, c1, r2, c2`.<br>**–í—ñ–¥–ø–æ–≤—ñ–¥—å (Byte 4):**<br>`AA` ‚Äî –£—Å–ø—ñ—Ö (—Ö—ñ–¥ –≤–∞–ª—ñ–¥–Ω–∏–π, –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –∫–∞—Å–∫–∞–¥).<br>`EE` ‚Äî –ü–æ–º–∏–ª–∫–∞ (–Ω–µ–º–∞—î –ª—ñ–Ω—ñ—ó 3-–≤-—Ä—è–¥, —Ö—ñ–¥ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ).<br>`DD` ‚Äî Deadlock (—Ö—ñ–¥ –≤–∞–ª—ñ–¥–Ω–∏–π, –∞–ª–µ –ø—ñ—Å–ª—è –ø–∞–¥—ñ–Ω–Ω—è –∫—É–±–∏–∫—ñ–≤ —Ö–æ–¥—ñ–≤ –±—ñ–ª—å—à–µ –Ω–µ–º–∞—î).<br>*–ü—Ä–∏–º—ñ—Ç–∫–∞: –£ —Ä–∞–∑—ñ —É—Å–ø—ñ—Ö—É MCU –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–æ–∑—ñ—à–ª–µ –æ–Ω–æ–≤–ª–µ–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ (Diff) —á–µ—Ä–µ–∑ `0x16`.* |
| **`0x14`** | `GET CELL` | `PC -> MCU` | –ó–∞–ø–∏—Ç –∫–æ–ª—å–æ—Ä—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –∫–ª—ñ—Ç–∏–Ω–∫–∏. –ë–∞–π—Ç–∏ 1-2 –º—ñ—Å—Ç—è—Ç—å `r, c`.<br>**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –£ –ë–∞–π—Ç—ñ 3 –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è ID –∫–æ–ª—å–æ—Ä—É (1-6). –ë–∞–π—Ç 4 –º—ñ—Å—Ç–∏—Ç—å —Å—Ç–∞—Ç—É—Å `AA` –∞–±–æ `EE` (—è–∫—â–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Ö–∏–±–Ω—ñ). |
| **`0x15`** | `GET SCORE` | `PC -> MCU` | –ó–∞–ø–∏—Ç –ø–æ—Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Ö—É–Ω–∫—É. <br>**–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –†–∞—Ö—É–Ω–æ–∫ (`uint32_t`) —Ä–æ–∑–±–∏–≤–∞—î—Ç—å—Å—è –Ω–∞ 4 –±–∞–π—Ç–∏ —ñ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è —É –ë–∞–π—Ç–∞—Ö 1, 2, 3, 4 (–≤—ñ–¥ –Ω–∞–π—Å—Ç–∞—Ä—à–æ–≥–æ –¥–æ –Ω–∞–π–º–æ–ª–æ–¥—à–æ–≥–æ). –°—Ç–∞—Ç—É—Å—É `AA` —É —Ü—å–æ–º—É –ø–∞–∫–µ—Ç—ñ –Ω–µ–º–∞—î. |
| **`0x16`** | `UPDATE CELL`| `MCU -> PC` | **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞!** –ü–ª–∞—Ç–∞ —Å–∞–º–∞ –Ω–∞–¥—Å–∏–ª–∞—î —Ü–µ–π –ø–∞–∫–µ—Ç, —è–∫—â–æ –∫–ª—ñ—Ç–∏–Ω–∫–∞ –∑–º—ñ–Ω–∏–ª–∞ –∫–æ–ª—ñ—Ä –ø—ñ—Å–ª—è —Ö–æ–¥—É –∞–±–æ –ø–∞–¥—ñ–Ω–Ω—è. –ë–∞–π—Ç–∏ 1-2: `r, c`. –ë–∞–π—Ç 3: –ù–æ–≤–∏–π –∫–æ–ª—ñ—Ä. –ë–∞–π—Ç 4: `AA`. |

### –ö–æ–¥–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤ –≥—Ä–∏ (Byte 4)
* **`0xAA`** ‚Äî OK (–û–ø–µ—Ä–∞—Ü—ñ—è —É—Å–ø—ñ—à–Ω–∞).
* **`0xEE`** ‚Äî ERROR (–ü–æ–º–∏–ª–∫–∞ –ª–æ–≥—ñ–∫–∏ / –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ / –Ω–µ–≤—ñ—Ä–Ω–∏–π CRC).
* **`0xDD`** ‚Äî DEADLOCK (–ì—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–∏—Ö —Ö–æ–¥—ñ–≤).
* **`0xFF`** ‚Äî –ù–µ–≤—ñ–¥–æ–º–∞ –∫–æ–º–∞–Ω–¥–∞.
